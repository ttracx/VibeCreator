import{r as S,h as N,j as z,g,o,w as t,a as s,v as J,b as y,c as d,f as k,t as w,d as u,F as h,e as P,n as V,p as H,l as K,m as Q,k as M,G as B,u as D,i as X,B as Y,c0 as j,b5 as ee,y as I,N as T,Z as te,x as A}from"./app-Bmr4PHMT.js";import{u as se}from"./useNotifications-B3huEiLp.js";import{l as O}from"./helpers-D9KGzndC.js";import{_ as le}from"./PageHeader-BqyuA5fp.js";import{_ as L,C as oe,a as ae,b as ne}from"./PostsFilter-CipTDrjq.js";import{_ as R,T as ie}from"./Tab-BdeB5PPy.js";import{_ as re}from"./Panel-B1uH97s0.js";import{_ as U}from"./Checkbox-Lm6d8_G-.js";import{_,a as G,T as ue}from"./TableCell-CK4B-up-.js";import{a as de,_ as ce}from"./PureDangerButton-D_SDiE36.js";import{_ as me}from"./DangerButton-DSZl10eC.js";import{u as fe}from"./SearchInput-RE6VC1bJ.js";import{_ as pe}from"./MediaFile-GmmivgAR.js";import{_ as E,h as ve,g as _e,a as ge}from"./VerticallyScrollableContent-D5WZmV7c.js";import{b as xe,T as be,_ as ke}from"./Trash-CZRC-GeC.js";import{_ as ye}from"./PureButton-u9cuJajJ.js";import{_ as F}from"./Account-Be3iKtLq.js";import{_ as $e}from"./Badge-Dp8jXFBf.js";import{_ as he}from"./NoResult-CLR1IQem.js";import"./EllipsisVertical-Dl-CnECd.js";import"./PrimaryButton-D4JjRc0A.js";import"./ProviderIcon-BlLqHFNz.js";import"./Input-B92tWi22.js";import"./ExclamationCircle-CrZtOZP6.js";import"./Alert-DSMQfzJS.js";const we=()=>{const l=S([]),r=S([]),c=N({get(){return $(l.value)},set(){const a=l.value;if($(a)){x(a);return}p(a)}}),f=a=>{l.value=a},p=a=>{for(const n of a)b(n)||r.value.push(n)},i=a=>{let n=r.value.indexOf(a);n!==-1&&r.value.splice(n,1)},x=a=>{for(const n of a)i(n)},C=()=>{r.value=[]},b=a=>r.value.includes(a),$=a=>a.length?a.every(n=>b(n)):!1;return{selectedRecords:r,toggleSelectRecordsOnPage:c,putPageRecords:f,deselectRecord:i,deselectAllRecords:C}},Ce={class:"w-44"},De={key:0,class:"text-sm mt-xs text-gray-500"},Re={key:1,class:"text-sm mt-xs text-gray-500"},Pe={class:"w-96 text-left break-words"},Se={key:0,class:"w-48 flex relative"},Oe={key:0,class:"absolute top-0 -right-5 z-10"},Ve={class:"flex flex-wrap gap-xs"},Ne={class:"flex gap-xs"},Be={class:"mr-xs"},je={class:"text-left"},Ie={class:"mr-xs flex items-center"},Te={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(l){const r=l,{getOriginalVersion:c,getAccountVersion:f}=fe(),p=N(()=>{if(!r.item.versions.length)return{excerpt:"",media:null,media_count:0};let b=r.item.accounts;r.filter.accounts.length&&(b=b.filter(n=>r.filter.accounts.includes(n.id)));const $=b.map(n=>{const v=f(r.item.versions,n.id);return v?v.content[0]:c(r.item.versions).content[0]}),a=$.length?$[0]:r.item.versions[0].content[0];return{excerpt:a.excerpt,media:a.media.length?a.media[0]:null,media_count:a.media.length}}),i=S(!1),x=()=>{i.value=!0},C=()=>{i.value=!1};return(b,$)=>{const a=z("tooltip");return o(),g(G,{hoverable:!0},{default:t(()=>[s(_,{class:"w-10"},{default:t(()=>[J(b.$slots,"checkbox")]),_:3}),s(_,{clickable:!0,onClick:x},{default:t(()=>[y("div",Ce,[s(E,{value:l.item.status},null,8,["value"]),l.item.status==="SCHEDULED"?(o(),d("div",De,w(l.item.scheduled_at.human),1)):k("",!0),l.item.status==="PUBLISHED"?(o(),d("div",Re,w(l.item.published_at.human),1)):k("",!0)])]),_:1}),s(_,{clickable:!0,onClick:x,class:"pl-0!"},{default:t(()=>[y("div",Pe,w(p.value.excerpt),1)]),_:1}),s(_,{clickable:!0,onClick:x},{default:t(()=>[p.value.media?(o(),d("div",Se,[p.value.media?(o(),g(pe,{key:0,media:p.value.media,"img-height":"sm",imgWidthFull:!1,showCaption:!1},{default:t(()=>[p.value.media_count>1?(o(),d("div",Oe,[s($e,null,{default:t(()=>[u("+"+w(p.value.media_count-1),1)]),_:1})])):k("",!0)]),_:1},8,["media"])):k("",!0)])):k("",!0)]),_:1}),s(_,{clickable:!0,onClick:x},{default:t(()=>[y("div",Ve,[(o(!0),d(h,null,P(l.item.tags,n=>(o(),g(ve,{key:n.id,item:n,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),s(_,null,{default:t(()=>[y("div",Ne,[(o(!0),d(h,null,P(l.item.accounts.slice(0,3),(n,v)=>(o(),d("div",{key:n.id,class:V({"-ml-6":v>0})},[H(s(F,{provider:n.provider,"img-url":n.image,active:!0},null,8,["provider","img-url"]),[[a,n.name]])],2))),128)),l.item.accounts.length>3?(o(),g(K,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:t(()=>[s(ye,{class:"mt-4 font-semibold"},{default:t(()=>[u("+"+w(l.item.accounts.slice(3).length),1)]),_:1})]),content:t(()=>[s(_e,null,{default:t(()=>[(o(!0),d(h,null,P(l.item.accounts.slice(3),n=>(o(),g(Q,{as:"div"},{default:t(()=>[y("span",Be,[s(F,{provider:n.provider,"img-url":n.image,active:!0},null,8,["provider","img-url"])]),y("span",je,w(n.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):k("",!0)])]),_:1}),s(_,null,{default:t(()=>[s(L,{"item-id":l.item.id},null,8,["item-id"])]),_:1}),s(xe,{show:i.value,scrollableBody:!0,onClose:C},{body:t(()=>[s(E,{value:l.item.status,class:"mb-lg"},null,8,["value"]),i.value?(o(),g(ge,{key:0,accounts:l.item.accounts,versions:l.item.versions},null,8,["accounts","versions"])):k("",!0)]),footer:t(()=>[i.value?(o(),d(h,{key:0},[y("div",Ie,[s(L,{"item-id":l.item.id},null,8,["item-id"])]),s(M,{onClick:C},{default:t(()=>$[0]||($[0]=[u("Close")])),_:1,__:[0]})],64)):k("",!0)]),_:1},8,["show"])]),_:3})}}},Ae={class:"bg-white border border-gray-100 rounded-lg p-sm w-fit"},Le={class:"flex flex-wrap items-center space-x-1"},q="px-sm py-xs rounded-md leading-4",Ue={__name:"Pagination",props:{meta:{type:Object,default:{current_page:1,from:1,last_page:1,per_page:2,to:1,total:0,links:[]}},links:{type:Object,default:{first:null,last:null,next:null,prev:null}}},setup(l){const r=l,c=N(()=>r.meta.links.map(f=>{const p=f.label.replace("&laquo; ","").replace(" &raquo;","");return{active:f.active,url:f.url,label:p,component:isNaN(parseInt(f.label))?{Next:ae,Previous:oe}[p]:null}}));return(f,p)=>(o(),d("div",Ae,[y("div",Le,[(o(!0),d(h,null,P(c.value,(i,x)=>(o(),d(h,null,[i.url===null?(o(),d("div",{key:x,class:V([[q,{"px-0!":i.label==="...","px-xs!":i.component}],"text-gray-400"])},[i.component?(o(),g(B(i.component),{key:0})):(o(),d(h,{key:1},[u(w(i.label),1)],64))],2)):(o(),g(D(X),{key:`link-${x}`,disabled:"",class:V(["transition-colors ease-in-out duration-200",[q,{"bg-indigo-500 text-white":i.active,"hover:text-indigo-500 focus:text-indigo-500":!i.active,"px-xs!":i.component}]]),href:i.url},{default:t(()=>[i.component?(o(),g(B(i.component),{key:0})):(o(),d(h,{key:1},[u(w(i.label),1)],64))]),_:2},1032,["class","href"]))],64))),256))])]))}},Ee={class:"row-py mb-2xl"},Fe={class:"w-full row-px"},qe={class:"w-full row-px mt-lg"},ze={key:0,class:"mt-lg"},vt={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1}},setup(l){const r=l,c=S({keyword:r.filter.keyword,status:r.filter.status,tags:r.filter.tags,accounts:r.filter.accounts}),{selectedRecords:f,putPageRecords:p,toggleSelectRecordsOnPage:i,deselectRecord:x,deselectAllRecords:C}=we(),b=()=>r.posts.data.map(v=>v.id);Y(()=>{p(b()),j.on("postDelete",v=>{x(v)})}),ee(()=>{j.off("postDelete")}),I(()=>O.cloneDeep(c.value),O.throttle(()=>{T.get(route("mixpost.posts.index"),O.pickBy(c.value),{preserveState:!0,only:["posts","filter"]})},300)),I(()=>r.posts.data,()=>{p(b())});const{notify:$}=se(),a=S(!1),n=()=>{T.delete(route("mixpost.posts.multipleDelete"),{data:{posts:f.value,status:c.value.status},onSuccess(){C(),$("success","Selected posts deleted")},onFinish(){a.value=!1}})};return(v,e)=>{const W=z("tooltip");return o(),d(h,null,[s(D(te),{title:"Posts"}),y("div",Ee,[s(le,{title:"Posts"},{default:t(()=>[s(ne,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=m=>c.value=m),class:"ml-2"},null,8,["modelValue"])]),_:1}),y("div",Fe,[s(ie,null,{default:t(()=>[s(R,{onClick:e[1]||(e[1]=m=>c.value.status=null),active:!v.$page.props.filter.status},{default:t(()=>e[11]||(e[11]=[u("All")])),_:1,__:[11]},8,["active"]),s(R,{onClick:e[2]||(e[2]=m=>c.value.status="draft"),active:v.$page.props.filter.status==="draft"},{default:t(()=>e[12]||(e[12]=[u("Drafts")])),_:1,__:[12]},8,["active"]),s(R,{onClick:e[3]||(e[3]=m=>c.value.status="scheduled"),active:v.$page.props.filter.status==="scheduled"},{default:t(()=>e[13]||(e[13]=[u("Scheduled")])),_:1,__:[13]},8,["active"]),s(R,{onClick:e[4]||(e[4]=m=>c.value.status="published"),active:v.$page.props.filter.status==="published"},{default:t(()=>e[14]||(e[14]=[u("Published")])),_:1,__:[14]},8,["active"]),l.has_failed_posts?(o(),g(R,{key:0,onClick:e[5]||(e[5]=m=>c.value.status="failed"),active:v.$page.props.filter.status==="failed",class:"text-red-500"},{default:t(()=>e[15]||(e[15]=[u("Failed")])),_:1,__:[15]},8,["active"])):k("",!0)]),_:1})]),y("div",qe,[s(ce,{count:D(f).length,onClose:D(C)},{default:t(()=>[H((o(),g(de,{onClick:e[6]||(e[6]=m=>a.value=!0)},{default:t(()=>[s(be)]),_:1})),[[W,"Delete"]])]),_:1},8,["count","onClose"]),s(re,{"with-padding":!1},{default:t(()=>[s(ue,null,{head:t(()=>[s(G,null,{default:t(()=>[s(_,{component:"th",scope:"col",class:"w-10"},{default:t(()=>[s(U,{checked:D(i),"onUpdate:checked":e[7]||(e[7]=m=>A(i)?i.value=m:null),disabled:!l.posts.meta.total},null,8,["checked","disabled"])]),_:1}),s(_,{component:"th",scope:"col",class:"w-44"},{default:t(()=>e[16]||(e[16]=[u("Status")])),_:1,__:[16]}),s(_,{component:"th",scope:"col",class:"pl-0! text-left"},{default:t(()=>e[17]||(e[17]=[u("Content")])),_:1,__:[17]}),s(_,{component:"th",scope:"col",class:"w-48"},{default:t(()=>e[18]||(e[18]=[u("Media")])),_:1,__:[18]}),s(_,{component:"th",scope:"col"},{default:t(()=>e[19]||(e[19]=[u("Labels")])),_:1,__:[19]}),s(_,{component:"th",scope:"col"},{default:t(()=>e[20]||(e[20]=[u("Accounts")])),_:1,__:[20]}),s(_,{component:"th",scope:"col"})]),_:1})]),body:t(()=>[(o(!0),d(h,null,P(l.posts.data,m=>(o(),g(Te,{key:m.id,item:m,filter:l.posts.filter,onOnDelete:()=>{D(x)(m.id)}},{checkbox:t(()=>[s(U,{checked:D(f),"onUpdate:checked":e[8]||(e[8]=Z=>A(f)?f.value=Z:null),value:m.id,number:""},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),l.posts.meta.total?k("",!0):(o(),g(he,{key:0,class:"py-md px-md"},{default:t(()=>e[21]||(e[21]=[u("No posts found.")])),_:1,__:[21]}))]),_:1}),l.posts.meta.links.length>3?(o(),d("div",ze,[s(Ue,{meta:l.posts.meta,links:l.posts.links},null,8,["meta","links"])])):k("",!0)])]),s(ke,{show:a.value,variant:"danger",onClose:e[10]||(e[10]=m=>a.value=!1)},{header:t(()=>e[22]||(e[22]=[u(" Delete posts ")])),body:t(()=>e[23]||(e[23]=[u(" Are you sure you want to delete selected posts? ")])),footer:t(()=>[s(M,{onClick:e[9]||(e[9]=m=>a.value=!1),class:"mr-xs"},{default:t(()=>e[24]||(e[24]=[u("Cancel")])),_:1,__:[24]}),s(me,{onClick:n},{default:t(()=>e[25]||(e[25]=[u("Delete")])),_:1,__:[25]})]),_:1},8,["show"])],64)}}};export{vt as default};
